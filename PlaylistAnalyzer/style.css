/* CSS Variables for Theming */
:root {
    /* Light Theme Defaults - Adjusted for palette consistency */
    --bg-primary: #f0f4f8; /* Very Light Gray */
    --bg-secondary: #ffffff; /* Pure White */
    --bg-section: #e0f2fe; /* Lightest blue from palette for sections/cards */
    --text-primary: #092a44; /* Dark Blue from palette for primary text */
    --text-secondary: #2c4d6f; /* Slightly lighter dark blue for secondary text */
    --text-header: #092a44; /* Dark Blue for headers */
    --text-accent: #72b7e3; /* Mid blue from palette for accent */
    --border-color: #c9e1f4; /* Light blue from palette for borders */
    --shadow-color-light: rgba(0, 0, 0, 0.1);
    --shadow-color-dark: rgba(0, 0, 0, 0.05);
    --shadow-inset-color: rgba(0, 0, 0, 0.06);

    /* Chart Colors - Using blues from the palette for light theme */
    --chart-bar-songs: #72b7e3; /* Mid blue */
    --chart-bar-songs-hover: #87cdfe; /* Lighter blue for hover */
    --chart-bar-energy: #f87171; /* Keep red for energy as a contrast */
    --chart-bar-energy-hover: #ef4444;
    --chart-bar-histogram: #a7cde9; /* Another mid blue */
    --chart-bar-histogram-hover: #c9e1f4; /* Lighter blue for hover */
    --chart-axis-text: #092a44; /* Dark blue for axis text */
    --chart-grid: #c9e1f4; /* Light blue for grid */

    /* Info Box Colors (keeping vibrant for light theme) */
    --info-bg-green: #ecfdf5; /* Green-50 */
    --info-border-green: #a7f3d0; /* Green-200 */
    --info-text-green: #047857; /* Green-700 */
    --info-bg-yellow: #fffdf0; /* Yellow-50 */
    --info-border-yellow: #fde68a; /* Yellow-200 */
    --info-text-yellow: #b45309; /* Yellow-700 */
    --info-bg-purple: #f5f3ff; /* Purple-50 */
    --info-border-purple: #d8b4fe; /* Purple-200 */
    --info-text-purple: #7e22ce; /* Purple-700 */

    /* Button Colors */
    --btn-primary-bg: #72b7e3; /* Primary button uses a palette blue */
    --btn-primary-hover-bg: #87cdfe; /* Lighter palette blue for hover */
    --btn-danger-bg: #ef4444; /* Red */
    --btn-danger-hover-bg: #dc2626; /* Darker Red */
    --btn-secondary-bg: #c9e1f4; /* Secondary button uses a light blue */
    --btn-secondary-text: #092a44; /* Dark text on secondary button */
    --btn-secondary-hover-bg: #a7cde9; /* Slightly darker light blue for hover */

    /* Input/Table Colors - Light mode specific rows */
    --input-border: #a7cde9; /* Input border from palette */
    --input-focus-ring: #72b7e3; /* Accent blue for focus ring */
    --table-header-bg: #c9e1f4; /* Table header from palette */
    --table-border: #a7cde9; /* Table border from palette */
    --table-row-odd-bg: #c9e1f4; /* Light row color from palette */
    --table-row-even-bg: #a7cde9; /* Darker light row color from palette */

    /* Message Colors */
    --error-text: #dc2626; /* Red-600 */
    --upload-success-text: #16a34a; /* Green-600 */

    /* New variables for grid layout */
    --bar-histogram: var(--chart-bar-histogram);
    --bar-histogram-hover: var(--chart-bar-histogram-hover);
}

/* Dark Mode Overrides - REVISED */
body.dark {
    --bg-primary: #092a44; /* Dark Blue from palette */
    --bg-secondary: #123456; /* Slightly lighter dark blue for main containers */
    --bg-section: #0b2238; /* Even darker blue for sections/cards */
    --text-primary: #e0f2fe; /* Very light blue for primary text */
    --text-secondary: #a7cde9; /* Lighter blue from palette for secondary text */
    --text-header: #72b7e3; /* Mid blue from palette for headers */
    --text-accent: #87cdfe; /* Brightest blue from palette for accent */
    --border-color: #2c4d6f; /* A darker border color for separation */
    --shadow-color-light: rgba(0, 0, 0, 0.4);
    --shadow-color-dark: rgba(0, 0, 0, 0.2);
    --shadow-inset-color: rgba(0, 0, 0, 0.35);

    /* Chart Colors - Adjusted to work with new blue palette for dark mode */
    --chart-bar-songs: #72b7e3; /* Mid blue, visible on dark background */
    --chart-bar-songs-hover: #87cdfe; /* Lighter blue for hover */
    --chart-bar-energy: #f87171; /* Keep red, ensuring it's vibrant */
    --chart-bar-energy-hover: #ef4444;
    --chart-bar-histogram: #a7cde9; /* Another mid blue for histogram */
    --chart-bar-histogram-hover: #c9e1f4; /* Lighter blue for hover */
    --chart-axis-text: #c9e1f4; /* Lightest blue for axis text */
    --chart-grid: #2c4d6f; /* Darker grid lines, but visible */

    /* Info Box Colors - Consistent dark mode look */
    --info-bg-green: #0d382d;
    --info-border-green: #1a6e4d;
    --info-text-green: #6ee7b7;
    --info-bg-yellow: #4d3a0d;
    --info-border-yellow: #9d7d1e;
    --info-text-yellow: #eab308;
    --info-bg-purple: #351c4e;
    --info-border-purple: #6a3abf;
    --info-text-purple: #c084fc;

    /* Button Colors */
    --btn-primary-bg: #72b7e3;
    --btn-primary-hover-bg: #87cdfe;
    --btn-danger-bg: #ef4444;
    --btn-danger-hover-bg: #dc2626;
    --btn-secondary-bg: #2c4d6f;
    --btn-secondary-text: #e0f2fe;
    --btn-secondary-hover-bg: #3b608a;

    /* Input/Table Colors - Dark mode specific rows */
    --input-border: #3b608a;
    --input-focus-ring: #87cdfe;
    --table-header-bg: #123456;
    --table-border: #2c4d6f;
    --table-row-odd-bg: #123456; /* Odd row background matches secondary */
    --table-row-even-bg: #0b2238; /* Even row background matches section background */

    /* New variables for grid layout */
    --bar-histogram: var(--chart-bar-histogram);
    --bar-histogram-hover: var(--chart-bar-histogram-hover);
}

/* Apply CSS Variables */
body {
    font-family: 'Red Hat Display', sans-serif;
    background-color: var(--bg-primary);
    color: var(--text-primary);
    transition: background-color 0.3s ease, color 0.3s ease;
}
.container {
    background-color: var(--bg-secondary);
    border-radius: 1.5rem; /* rounded-3xl */
    box-shadow: 0 10px 15px -3px var(--shadow-color-light), 0 4px 6px -2px var(--shadow-color-dark);
    padding: 2.5rem;
}
h1, h2, h3 {
    font-family: 'Red Hat Display', sans-serif;
    font-weight: 600;
}
/* Ensure h1 and h2 use the accent color for prominence in light mode */
h1 {
    color: var(--text-accent); /* Previously hardcoded, now themed */
    font-size: 2.8rem;
}
h2 {
    color: var(--text-accent); /* Previously hardcoded, now themed */
    font-size: 2.2rem;
}
/* Chart subtitles should use header color for contrast */
.chart-container-wrapper h3 {
    color: var(--text-header);
}

/* Ensure paragraph text uses secondary text color where appropriate */
body > .container > header > p, /* Main header description */
#noSongsMessage, /* "No songs" message */
.chart-container-wrapper p /* Chart description text */
{
    color: var(--text-secondary);
}


.chart-container-wrapper, .data-section-wrapper {
    background-color: var(--bg-section);
    border-radius: 1.5rem; /* rounded-3xl */
    box-shadow: inset 0 2px 4px 0 var(--shadow-inset-color);
    padding: 1.5rem;
    margin-bottom: 2.5rem;
}

/* Explicit fill for D3.js bars to ensure they are always themed */
.bar.bar-songs {
    fill: var(--chart-bar-songs);
}
.bar.bar-songs:hover {
    fill: var(--chart-bar-songs-hover);
}
.bar.bar-energy {
    fill: var(--chart-bar-energy);
}
.bar.bar-energy:hover {
    fill: var(--chart-bar-energy-hover);
}
.bar.bar-histogram {
    fill: var(--chart-bar-histogram);
}
.bar.bar-histogram:hover {
    fill: var(--chart-bar-histogram-hover);
}


.axis text {
    fill: var(--chart-axis-text);
}
.axis line, .axis path {
    stroke: var(--chart-grid);
    stroke-width: 0.5;
}
.input-field {
    border: 1px solid var(--input-border);
    background-color: var(--bg-secondary);
    color: var(--text-primary);
    border-radius: 0.75rem; /* rounded-xl */
    padding: 0.75rem 1rem;
}
.input-field:focus {
    outline: none;
    box-shadow: 0 0 0 3px var(--input-focus-ring);
    border-color: var(--input-focus-ring);
}
.btn-primary, .btn-danger, .btn-secondary {
    border-radius: 0.75rem; /* rounded-xl */
    padding: 0.75rem 1.5rem;
    font-weight: 500;
    transition: background-color 0.2s ease, transform 0.1s ease;
    border: none;
}
.btn-primary {
    background-color: var(--btn-primary-bg);
    color: white;
}
.btn-primary:hover {
    background-color: var(--btn-primary-hover-bg);
    transform: translateY(-1px);
}
.btn-danger {
    background-color: var(--btn-danger-bg);
    color: white;
}
.btn-danger:hover {
    background-color: var(--btn-danger-hover-bg);
    transform: translateY(-1px);
}
.btn-secondary {
    background-color: var(--btn-secondary-bg);
    color: var(--btn-secondary-text);
}
.btn-secondary:hover {
    background-color: var(--btn-secondary-hover-bg);
    transform: translateY(-1px);
}
table {
    border-collapse: separate;
    border-spacing: 0;
    border: 1px solid var(--table-border);
    border-radius: 0.75rem; /* rounded-xl */
    overflow: hidden;
    width: 100%;
}
th, td {
    border-bottom: 1px solid var(--table-border);
    padding: 1rem 1.25rem;
    color: var(--text-primary);
}
th {
    background-color: var(--table-header-bg);
    font-weight: 600;
    color: var(--text-header);
}
/* Light Mode specific table rows */
body:not(.dark) tbody tr:nth-child(odd) {
    background-color: var(--table-row-odd-bg);
}
body:not(.dark) tbody tr:nth-child(even) {
    background-color: var(--table-row-even-bg);
}
/* Dark Mode specific table rows (already defined in body.dark, but explicit here for clarity) */
body.dark tbody tr:nth-child(odd) {
    background-color: var(--table-row-odd-bg); /* Uses dark theme variable */
}
body.dark tbody tr:nth-child(even) {
    background-color: var(--table-row-even-bg); /* Uses dark theme variable */
}

tr:last-child td {
    border-bottom: none;
}
.text-red-600 {
    color: var(--error-text);
}
.text-green-600 {
    color: var(--upload-success-text);
}

/* Info Box Specifics */
.p-6.bg-green-50, .p-6.bg-yellow-50, .p-6.bg-purple-50 {
    border-radius: 1rem;
    border-width: 1px;
}
.p-6.bg-green-50 { background-color: var(--info-bg-green); border-color: var(--info-border-green); }
.p-6.bg-green-50 .text-green-700 { color: var(--info-text-green); }
.p-6.bg-yellow-50 { background-color: var(--info-bg-yellow); border-color: var(--info-border-yellow); }
.p-6.bg-yellow-50 .text-yellow-700 { color: var(--info-text-yellow); }
.p-6.bg-purple-50 { background-color: var(--info-bg-purple); border-color: var(--info-border-purple); }
.p-6.bg-purple-50 .text-purple-700 { color: var(--info-text-purple); }

/* Ensure Tailwind's default text-gray classes map to our theme variables */
.text-gray-600, .text-gray-500 { /* For general secondary text like header description, no-songs message */
    color: var(--text-secondary);
}
.text-gray-800 { /* For primary text elements that might use this class */
    color: var(--text-primary);
}
/* This specific rule was for chart subtitles, now general for h3 in chart wrappers */
/* .text-gray-700 {
    color: var(--text-header);
} */


/* Sticky Dark Mode Toggle Button */
#darkModeToggle {
    position: fixed;
    bottom: 2rem;
    right: 2rem;
    top: auto;
    left: auto;
    z-index: 1000;
    width: 3.5rem;
    height: 3.5rem;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 4px 6px -1px var(--shadow-color-light), 0 2px 4px -1px var(--shadow-color-dark);
    cursor: pointer;
    transition: background-color 0.3s ease, transform 0.2s ease, color 0.3s ease;
    background-color: var(--btn-secondary-bg);
    color: var(--btn-secondary-text);
}
#darkModeToggle:hover {
    background-color: var(--btn-secondary-hover-bg);
    transform: translateY(-2px);
}
#darkModeToggle svg {
    width: 1.75rem;
    height: 1.75rem;
}

/* Icon toggling */
body.dark .sun-icon {
    display: block;
}
body.dark .moon-icon {
    display: none;
}
body:not(.dark) .sun-icon {
    display: none;
}
body:not(.dark) .moon-icon {
    display: block;
}

/* Restore grid layout for key insights row */
.info-box-grid {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr;
    gap: 1.5rem;
    margin-bottom: 2.5rem;
}
@media (max-width: 900px) {
    .info-box-grid {
        grid-template-columns: 1fr;
    }
}

/* Navigation Bar Styles */
.nav-bar {
    display: flex;
    gap: 2rem;
    justify-content: flex-start;
    align-items: center;
    padding-bottom: 2rem;
    border-bottom: 1px solid var(--border-color);
    margin-bottom: 2.5rem;
}
.nav-link {
    font-size: 1.1rem;
    color: var(--text-accent);
    text-decoration: none;
    font-weight: 500;
    padding: 0.5rem 1.2rem;
    border-radius: 0.75rem;
    transition: background 0.2s, color 0.2s;
}
.nav-link:hover {
    background: var(--btn-secondary-bg);
    color: var(--btn-secondary-text);
}
.nav-link-active {
    background: var(--btn-primary-bg);
    color: #fff;
    cursor: default;
}
