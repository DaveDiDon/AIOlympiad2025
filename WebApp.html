<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Enhanced Playlist Insights</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8; /* Light Gray */
            color: #334155; /* Slate-700 */
        }
        .container {
            max-width: 96%; /* Slightly wider container */
            margin: 2rem auto;
            padding: 2rem;
            background-color: #ffffff;
            border-radius: 1.25rem; /* rounded-2xl */
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); /* Larger shadow */
        }
        h1, h2 {
            color: #1e293b; /* Slate-800 */
            font-weight: 700; /* font-bold */
        }
        .chart-container-wrapper {
            background-color: #f8fafc; /* Slate-50 */
            padding: 1.5rem;
            border-radius: 1rem; /* rounded-xl */
            box-shadow: inset 0 2px 4px 0 rgba(0, 0, 0, 0.06); /* Inner shadow */
            margin-bottom: 2rem;
        }
        .bar-songs {
            fill: #60a5fa; /* blue-400 */
            transition: fill 0.2s ease-in-out;
        }
        .bar-songs:hover {
            fill: #3b82f6; /* blue-500 */
        }
        .bar-energy {
            fill: #f87171; /* red-400 */
            transition: fill 0.2s ease-in-out;
        }
        .bar-energy:hover {
            fill: #ef4444; /* red-500 */
        }
        .axis text {
            font-size: 0.875rem; /* text-sm */
            fill: #475569; /* slate-600 */
        }
        .axis line, .axis path {
            stroke: #cbd5e1; /* slate-300 */
            shape-rendering: crispEdges;
        }
        .tooltip {
            position: absolute;
            text-align: center;
            padding: 0.5rem;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            border-radius: 0.375rem; /* rounded-md */
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s;
            font-size: 0.875rem;
        }
    </style>
</head>
<body class="p-4">
    <div class="container">
        <header class="text-center mb-10 pb-6 border-b border-gray-200">
            <h1 class="text-4xl mb-4 text-indigo-700">My Enhanced Playlist Insights</h1>
            <p class="text-lg text-gray-600 max-w-2xl mx-auto">
                Dive into your music listening habits! This tool analyzes your playlist to show you your top artists, average energy levels, and how your music taste varies throughout the week.
            </p>
            <p class="text-sm text-gray-500 mt-2">
                (Data is pre-loaded for demonstration. Future versions could allow custom input!)
            </p>
        </header>

        <section class="mb-10">
            <h2 class="text-2xl mb-6 text-center text-indigo-600">Key Insights</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <div class="p-6 bg-green-50 rounded-lg shadow-md border border-green-200">
                    <h3 class="text-xl font-semibold mb-3 text-green-700">Top Artist</h3>
                    <p id="topArtistResult" class="text-lg text-gray-800"></p>
                </div>
                <div class="p-6 bg-yellow-50 rounded-lg shadow-md border border-yellow-200">
                    <h3 class="text-xl font-semibold mb-3 text-yellow-700">Overall Playlist Energy</h3>
                    <p id="energyLevelResult" class="text-lg text-gray-800"></p>
                </div>
                <div class="p-6 bg-purple-50 rounded-lg shadow-md border border-purple-200">
                    <h3 class="text-xl font-semibold mb-3 text-purple-700">Most Listened Day</h3>
                    <p id="dailyMusicStatement" class="text-lg text-gray-800"></p>
                </div>
            </div>
        </section>

        <section>
            <h2 class="text-2xl mb-6 text-center text-indigo-600">Visual Breakdown of Your Habits</h2>

            <div class="chart-container-wrapper">
                <h3 class="text-xl font-semibold mb-4 text-center text-gray-700">Songs Played Per Day</h3>
                <div id="songs-per-day-chart" class="flex justify-center">
                    </div>
            </div>

            <div class="chart-container-wrapper">
                <h3 class="text-xl font-semibold mb-4 text-center text-gray-700">Average Energy Level Per Day</h3>
                <div id="energy-per-day-chart" class="flex justify-center">
                    </div>
            </div>
        </section>
    </div>

    <div class="tooltip" style="opacity: 0;"></div>

    <script>
        // --- Expanded Playlist Data ---
        // Now with 20 songs for more diverse analysis
        const playlist_data = {
            'Song': [
                'Save Your Tears', 'Every Teardrop Is a Waterfall', 'Viva la Vida', 'HandClap',
                'Riptide', 'Make You Mine', 'Out of My League', 'A Sky Full of Stars',
                'Blinding Lights', 'The Less I Know The Better', 'Fix You', 'Mr. Brightside',
                'Watermelon Sugar', 'Sunflower', 'Thunderstruck', 'Imagine',
                'Dont Stop Believin\'', 'Lovely Day', 'Africa', 'Sweet Child o\' Mine'
            ],
            'Artist': [
                'The Weeknd', 'Coldplay', 'Coldplay', 'Fitz and The Tantrums',
                'Vance Joy', 'PUBLIC', 'Fitz and The Tantrums', 'Coldplay',
                'The Weeknd', 'Tame Impala', 'Coldplay', 'The Killers',
                'Harry Styles', 'Post Malone', 'AC/DC', 'John Lennon',
                'Journey', 'Bill Withers', 'Toto', 'Guns N\' Roses'
            ],
            'Energy': [
                0.7, 0.8, 0.8, 1.0, 0.5, 0.8, 0.9, 0.9,
                0.9, 0.6, 0.4, 0.9, 0.7, 0.8, 1.0, 0.3,
                0.9, 0.6, 0.7, 0.9
            ],
            'Day_Played': [
                'Monday', 'Tuesday', 'Wednesday', 'Thursday',
                'Friday', 'Saturday', 'Sunday', 'Monday',
                'Tuesday', 'Wednesday', 'Thursday', 'Friday',
                'Saturday', 'Sunday', 'Monday', 'Tuesday',
                'Wednesday', 'Thursday', 'Friday', 'Saturday'
            ]
        };

        // Convert to a more convenient array of objects for processing
        const playlist = playlist_data.Song.map((song, index) => ({
            Song: song,
            Artist: playlist_data.Artist[index],
            Energy: playlist_data.Energy[index],
            Day_Played: playlist_data.Day_Played[index]
        }));

        // Define the desired order of days for consistent plotting
        const daysOrder = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];

        // --- Analysis Functions ---

        function analyzeTopArtist() {
            const artistCounts = {};
            playlist.forEach(item => {
                artistCounts[item.Artist] = (artistCounts[item.Artist] || 0) + 1;
            });

            let topArtist = '';
            let topArtistCount = 0;
            for (const artist in artistCounts) {
                if (artistCounts[artist] > topArtistCount) {
                    topArtistCount = artistCounts[artist];
                    topArtist = artist;
                }
            }
            document.getElementById('topArtistResult').textContent = `${topArtist} (with ${topArtistCount} songs)`;
        }

        function analyzeAverageEnergy() {
            const totalEnergy = playlist.reduce((sum, item) => sum + item.Energy, 0);
            const averageEnergy = totalEnergy / playlist.length;

            let energyMessage = '';
            if (averageEnergy < 0.4) {
                energyMessage = "You're definitely a chill vibe listener.";
            } else if (averageEnergy > 0.6) {
                energyMessage = "Looks like you're ready to power through anything!";
            } else {
                energyMessage = "You've got a balanced mix of vibes going on!";
            }
            document.getElementById('energyLevelResult').textContent = `${averageEnergy.toFixed(2)} - ${energyMessage}`;
        }

        function analyzeMostPlayedDay() {
            const dayCounts = {};
            playlist.forEach(item => {
                dayCounts[item.Day_Played] = (dayCounts[item.Day_Played] || 0) + 1;
            });

            let mostPlayedDay = '';
            let maxPlays = 0;
            daysOrder.forEach(day => { // Iterate through ordered days to find max
                const count = dayCounts[day] || 0;
                if (count > maxPlays) {
                    maxPlays = count;
                    mostPlayedDay = day;
                }
            });

            document.getElementById('dailyMusicStatement').textContent = `Most songs (${maxPlays}) were played on ${mostPlayedDay}.`;
        }


        // --- D3.js Charting Functions ---
        const tooltip = d3.select(".tooltip");

        function drawChart(containerId, data, xDomainAccessor, yDomainAccessor, yLabel, barColorClass, type = 'songs') {
            const container = document.getElementById(containerId);
            if (!container) return; // Exit if container not found

            d3.select(`#${containerId} svg`).remove(); // Clear existing SVG on resize

            const margin = { top: 30, right: 30, bottom: 60, left: 50 };
            const containerWidth = container.offsetWidth;
            const width = containerWidth - margin.left - margin.right;
            const height = 350 - margin.top - margin.bottom;

            const svg = d3.select(`#${containerId}`)
                .append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform", `translate(${margin.left},${margin.top})`);

            // X axis
            const x = d3.scaleBand()
                .range([0, width])
                .domain(data.map(d => xDomainAccessor(d)))
                .padding(0.2);

            svg.append("g")
                .attr("transform", `translate(0,${height})`)
                .call(d3.axisBottom(x))
                .selectAll("text")
                .attr("transform", "translate(-10,0)rotate(-45)")
                .style("text-anchor", "end")
                .style("font-size", "0.9rem");

            // Y axis
            const y = d3.scaleLinear()
                .domain([0, d3.max(data, d => yDomainAccessor(d)) * (type === 'energy' ? 1.1 : 1.2)]) // Slightly extend Y for counts
                .range([height, 0]);

            svg.append("g")
                .call(d3.axisLeft(y).tickFormat(type === 'songs' ? d3.format("d") : d3.format(".1f"))); // Integer ticks for songs, one decimal for energy

            // Bars
            svg.selectAll(".bar")
                .data(data)
                .enter()
                .append("rect")
                .attr("x", d => x(xDomainAccessor(d)))
                .attr("y", d => y(yDomainAccessor(d)))
                .attr("width", x.bandwidth())
                .attr("height", d => height - y(yDomainAccessor(d)))
                .attr("class", `bar ${barColorClass} rounded-t-md`) // Apply Tailwind rounded corners
                .on("mouseover", function(event, d) {
                    d3.select(this).style("fill", d3.rgb(d3.select(this).style("fill")).darker(0.5));
                    tooltip.transition()
                        .duration(200)
                        .style("opacity", .9);
                    tooltip.html(`${xDomainAccessor(d)}: ${yDomainAccessor(d).toFixed(type === 'songs' ? 0 : 2)}`)
                        .style("left", (event.pageX + 10) + "px")
                        .style("top", (event.pageY - 28) + "px");
                })
                .on("mouseout", function() {
                    d3.select(this).style("fill", null); // Reset fill to CSS
                    tooltip.transition()
                        .duration(500)
                        .style("opacity", 0);
                });

            // Y-axis label
            svg.append("text")
                .attr("transform", "rotate(-90)")
                .attr("y", 0 - margin.left)
                .attr("x", 0 - (height / 2))
                .attr("dy", "1em")
                .style("text-anchor", "middle")
                .style("font-size", "0.9rem")
                .style("fill", "#475569")
                .text(yLabel);
        }

        function drawSongsPerDayChart() {
            const dayCounts = {};
            playlist.forEach(item => {
                dayCounts[item.Day_Played] = (dayCounts[item.Day_Played] || 0) + 1;
            });

            const chartData = daysOrder.map(day => ({
                day: day,
                count: dayCounts[day] || 0
            }));

            drawChart(
                'songs-per-day-chart',
                chartData,
                d => d.day,
                d => d.count,
                'Number of Songs Played',
                'bar-songs',
                'songs'
            );
        }

        function drawEnergyPerDayChart() {
            const energySumPerDay = {};
            const energyCountPerDay = {};

            playlist.forEach(item => {
                energySumPerDay[item.Day_Played] = (energySumPerDay[item.Day_Played] || 0) + item.Energy;
                energyCountPerDay[item.Day_Played] = (energyCountPerDay[item.Day_Played] || 0) + 1;
            });

            const chartData = daysOrder.map(day => ({
                day: day,
                averageEnergy: energyCountPerDay[day] > 0 ? energySumPerDay[day] / energyCountPerDay[day] : 0
            }));

            drawChart(
                'energy-per-day-chart',
                chartData,
                d => d.day,
                d => d.averageEnergy,
                'Average Energy Level (0-1)',
                'bar-energy',
                'energy'
            );
        }

        // --- Initialize Analysis and Charts on DOM Load ---
        document.addEventListener('DOMContentLoaded', () => {
            analyzeTopArtist();
            analyzeAverageEnergy();
            analyzeMostPlayedDay();
            drawSongsPerDayChart();
            drawEnergyPerDayChart();

            // Redraw charts on window resize for responsiveness
            window.addEventListener('resize', () => {
                drawSongsPerDayChart();
                drawEnergyPerDayChart();
            });
        });
    </script>
</body>
</html>
